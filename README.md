# PyQt5-minimal

[![Build Status](https://travis-ci.org/smarie/PyQt5-minimal.svg?branch=Qt5.6.3_PyQt_5.6_Python3.5)](https://travis-ci.org/smarie/PyQt5-minimal)

This project consists in a set of build scripts for the continuous integration engine, so as to build a minimal version of the Qt LGPL and PyQt5 GPL packages for linux.

This need came from project [envswitcher-gui](https://github.com/smarie/env-switcher-gui), which is a python app relying on PyQt5 and frozen into an executable using cx_Freeze. With the default PyQt distribution available in conda, the executable distribution ended up being as large as 80Mo! There were two reasons to this: 

* Qt was built using ICU, which brings quite large libraries
* several non-core usused Qt modules were included in PyQt

## Usage

In the [releases page](https://github.com/smarie/PyQt5-minimal/releases) you will find two kind of release packages:

* `Qt*.tar.gz` files are intermediate Qt binary distributions created in the build process, build with the options described below. Simply extract anywhere and add to your PATH, that way your PyQt distribution (below) will be able to load. Not sure that the included Qt toolchain (qmake) will work since the 'prefix' might not be the same on your computer than when the distribution has been built on Travis...

* `PyQt*.tar.gz` files are PyQt 'ready-to-install' distributions. PyQt normal installation procedure would be to extract anywhere and run `make install` in the root directory, in order to install the package in your current python environment. However this does not work if your folder structure is not the same than the one we use in the Travis continuous integration engine. Therefore you have to perform the same thing than `make install` manually, that is, to copy the interesting files in your current python environment's `site-packages` folder. For example (assuming current folder is the extracted PyQt archive's root folder):

```bash
export PYQT_INSTALL_DIR="$HOME/miniconda/lib/python3.5/site-packages/PyQt5"
mkdir $PYQT_INSTALL_DIR;
# copy all .so and .pyi files
find . \( -name "*so" -o -name "*pyi" \) -not -name "lib*" -exec cp {} $PYQT_INSTALL_DIR \;
# copy the main init file
cp ./__init__.py $PYQT_INSTALL_DIR;
```

*Note: similar to what happens when you perform the normal PyQt installation procedure with `make install`, the PyQt5 package does not appear in the list of packages managed by pip/conda. However you can check that it is available in python: `python -c "import PyQt5.QtCore"` does not throw any ImportError anymore*

*Note2: you need to install the `sip` package*

## Qt build options

The build options currently used to build Qt are

```bash
-opensource -confirm-license \
-no-icu -no-cups -no-qml-debug -no-compile-examples -no-harfbuzz -no-sql-mysql -no-sql-odbc -no-sql-sqlite -qt-pcre \
-skip qtlocation -skip qt3d -skip qtmultimedia -skip qtwebchannel -skip qtwayland -skip qtandroidextras -skip qtwebsockets -skip qtconnectivity -skip qtdoc -skip qtwebview -skip qtimageformats -skip qtwebengine -skip qtquickcontrols2 -skip qttranslations -skip qtxmlpatterns -skip qtactiveqt -skip qtx11extras -skip qtsvg -skip qtscript -skip qtserialport -skip qtdeclarative -skip qtgraphicaleffects -skip qtcanvas3d -skip qtmacextras -skip qttools -skip qtwinextras -skip qtsensors -skip qtenginio -skip qtquickcontrols -skip qtserialbus \
-nomake examples -nomake tests -nomake tools
```

## PyQt build options

The build options currently used to build PyQt are

```bash
--confirm-license \
--no-python-dbus --no-qml-plugin --no-qsci-api --no-tools \
--disable QtHelp --disable QtMultimedia --disable QtMultimediaWidgets --disable QtNetwork --disable QtOpenGL --disable QtPrintSupport --disable QtQml --disable QtQuick --disable QtSql --disable QtSvg --disable QtTest --disable QtWebKit --disable QtWebKitWidgets --disable QtXml --disable QtXmlPatterns --disable QtDesigner --disable QAxContainer --disable QtDBus --disable QtWebSockets --disable QtWebChannel --disable QtNfc --disable QtBluetooth --disable QtX11Extras --disable QtQuickWidgets --disable _QOpenGLFunctions_2_0 --disable _QOpenGLFunctions_2_1 --disable _QOpenGLFunctions_4_1_Core
```

Note: PyQt is patched so that Makefiles generated by Qt are able to find the libraries. Indeed the generated makefiles only contain `-rpath` which seems not sufficient for the linker to find the libraries - we therefore add `-L`. This may be linked to the following [issue](https://forum.qt.io/topic/59670/how-to-compile-qt-with-relative-runpath-paths) ? The patch file used can be found in `ci_tools/`, there is one per version.